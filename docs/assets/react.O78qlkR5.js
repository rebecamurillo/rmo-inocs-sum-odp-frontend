import{j as e,I as M}from"./input.Dj-3L-Vr.js";import{r}from"./index.mQ0qHaRU.js";import{R as _}from"./RButton.CAR3mGae.js";import{T as P,a as V,b as A,c as w,d as N,e as U}from"./textarea.9JPkEnx5.js";import{S as z}from"./select.DCRAX0Oq.js";import{F as G}from"./QuestionMarkCircleIcon.ESMEVjQ8.js";import{B as C,E as W}from"./Badge.BrwqOr3Y.js";import{F as L,L as E}from"./fieldset.CvsEtHeI.js";import{g as Z}from"./links.BishvqZb.js";import{M as q}from"./MapViewer.BE88z2l6.js";import"./index.JqWRG6qW.js";import"./index.GxtV8WE2.js";import"./hidden.DkZ3u52o.js";import"./Constants.BGkoVaDK.js";function T(a){if(!a)return"";const s=new Date(a);return Number.isNaN(s.getTime())?String(a):s.toISOString().slice(0,10)}var I=(a=>(a.NSM="NSM",a.PUBLIC_TRANSPORT="PUBLIC_TRANSPORT",a.PRIVATE="PRIVATE",a))(I||{}),v=(a=>(a.IN_SERVICE="IN_SERVICE",a.NEW="NEW",a.OPTIMIZATION_SCHEDULED="OPTIMIZATION_SCHEDULED",a.NOT_AVAILABLE="NOT_AVAILABLE",a))(v||{});function X({title:a,titleId:s,...t},n){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},t),a?r.createElement("title",{id:s},a):null,r.createElement("path",{d:"M4.214 3.227a.75.75 0 0 0-1.156-.955 8.97 8.97 0 0 0-1.856 3.825.75.75 0 0 0 1.466.316 7.47 7.47 0 0 1 1.546-3.186ZM16.942 2.272a.75.75 0 0 0-1.157.955 7.47 7.47 0 0 1 1.547 3.186.75.75 0 0 0 1.466-.316 8.971 8.971 0 0 0-1.856-3.825Z"}),r.createElement("path",{fillRule:"evenodd",d:"M10 2a6 6 0 0 0-6 6c0 1.887-.454 3.665-1.257 5.234a.75.75 0 0 0 .515 1.076 32.91 32.91 0 0 0 3.256.508 3.5 3.5 0 0 0 6.972 0 32.903 32.903 0 0 0 3.256-.508.75.75 0 0 0 .515-1.076A11.448 11.448 0 0 1 16 8a6 6 0 0 0-6-6Zm0 14.5a2 2 0 0 1-1.95-1.557 33.54 33.54 0 0 0 3.9 0A2 2 0 0 1 10 16.5Z",clipRule:"evenodd"}))}const J=r.forwardRef(X);function Q({title:a,titleId:s,...t},n){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},t),a?r.createElement("title",{id:s},a):null,r.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 1 0 0-16 8 8 0 0 0 0 16Zm3.857-9.809a.75.75 0 0 0-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 1 0-1.06 1.061l2.5 2.5a.75.75 0 0 0 1.137-.089l4-5.5Z",clipRule:"evenodd"}))}const R=r.forwardRef(Q);function Y({title:a,titleId:s,...t},n){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},t),a?r.createElement("title",{id:s},a):null,r.createElement("path",{fillRule:"evenodd",d:"M3 3.5A1.5 1.5 0 0 1 4.5 2h6.879a1.5 1.5 0 0 1 1.06.44l4.122 4.12A1.5 1.5 0 0 1 17 7.622V16.5a1.5 1.5 0 0 1-1.5 1.5h-11A1.5 1.5 0 0 1 3 16.5v-13Zm10.857 5.691a.75.75 0 0 0-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 0 0-1.06 1.061l2.5 2.5a.75.75 0 0 0 1.137-.089l4-5.5Z",clipRule:"evenodd"}))}const ee=r.forwardRef(Y);function se({title:a,titleId:s,...t},n){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},t),a?r.createElement("title",{id:s},a):null,r.createElement("path",{fillRule:"evenodd",d:"M8.485 2.495c.673-1.167 2.357-1.167 3.03 0l6.28 10.875c.673 1.167-.17 2.625-1.516 2.625H3.72c-1.347 0-2.189-1.458-1.515-2.625L8.485 2.495ZM10 5a.75.75 0 0 1 .75.75v3.5a.75.75 0 0 1-1.5 0v-3.5A.75.75 0 0 1 10 5Zm0 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z",clipRule:"evenodd"}))}const $=r.forwardRef(se);function ae({title:a,titleId:s,...t},n){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},t),a?r.createElement("title",{id:s},a):null,r.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 1 1-16 0 8 8 0 0 1 16 0Zm-7-4a1 1 0 1 1-2 0 1 1 0 0 1 2 0ZM9 9a.75.75 0 0 0 0 1.5h.253a.25.25 0 0 1 .244.304l-.459 2.066A1.75 1.75 0 0 0 10.747 15H11a.75.75 0 0 0 0-1.5h-.253a.25.25 0 0 1-.244-.304l.459-2.066A1.75 1.75 0 0 0 9.253 9H9Z",clipRule:"evenodd"}))}const D=r.forwardRef(ae);function te({title:a,titleId:s,...t},n){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},t),a?r.createElement("title",{id:s},a):null,r.createElement("path",{d:"m5.433 13.917 1.262-3.155A4 4 0 0 1 7.58 9.42l6.92-6.918a2.121 2.121 0 0 1 3 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 0 1-.65-.65Z"}),r.createElement("path",{d:"M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0 0 10 3H4.75A2.75 2.75 0 0 0 2 5.75v9.5A2.75 2.75 0 0 0 4.75 18h9.5A2.75 2.75 0 0 0 17 15.25V10a.75.75 0 0 0-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5Z"}))}const F=r.forwardRef(te);function re({title:a,titleId:s,...t},n){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":s},t),a?r.createElement("title",{id:s},a):null,r.createElement("path",{d:"M6.28 5.22a.75.75 0 0 0-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 1 0 1.06 1.06L10 11.06l3.72 3.72a.75.75 0 1 0 1.06-1.06L11.06 10l3.72-3.72a.75.75 0 0 0-1.06-1.06L10 8.94 6.28 5.22Z"}))}const K=r.forwardRef(re),le={success:{bg:"bg-success/50",border:"border-green-200",text:"text-primary",buttonBg:"border-success hover:border-success/90 text-primary"},warning:{bg:"bg-warning/50",border:"border-orange-200",text:"text-warning",buttonBg:"border-warning hover:border-warning/90 text-primary"},danger:{bg:"bg-danger/50",border:"border-red-200",text:"text-danger",buttonBg:"border-danger hover:border-danger/90 text-primary"},info:{bg:"bg-info/50",border:"border-sky-200",text:"text-primary",buttonBg:"border-primary hover:border-primary/90 text-primary"},neutral:{bg:"bg-dark/50",border:"border-gray-200",text:"text-dark",buttonBg:"border-dark hover:border-dark/90 text-primary"}},ne={info:e.jsx(D,{className:"h-10 w-10"}),question:e.jsx(G,{className:"h-10 w-10"}),success:e.jsx(R,{className:"h-10 w-10"}),warning:e.jsx($,{className:"h-10 w-10"}),danger:e.jsx($,{className:"h-10 w-10"}),neutral:e.jsx(D,{className:"h-10 w-10"})};function ie({title:a,icon:s,children:t,variant:n="info",actionText:d,onAction:x,className:u=""}){const c=le[n];return e.jsx("div",{className:`${c.bg} border ${c.border} rounded-lg p-2 ${u}`,role:"status","aria-live":"polite",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("div",{className:`${c.text}`,children:ne[s??n]}),e.jsxs("div",{className:"flex-1 gap-0",children:[a&&e.jsx("h5",{className:`${c.text}`,children:a}),e.jsx("p",{className:`${c.text}`,children:t})]}),d&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx(_,{variant:"link",onClick:x,className:`${c.buttonBg}`,text:d,defaultArrow:!0})})]})})}function Ae({id:a,title:s,description:t,completed:n,inProgress:d,locked:x,cta:u,href:c,onAction:h,className:i}){const l=()=>{x||(c&&(window.location.href=c),h?.(a))};return e.jsxs("div",{className:`flex flex-col gap-4 rounded-lg border p-4 lg:p-6 relative transition-all duration-200 ${n?" border-success cursor-pointer":x?"bg-light/30 border-dark cursor-not-allowed":"border-warning cursor-pointer"} ${i}`,onClick:l,children:[e.jsx("h4",{className:"text-primary",children:s}),e.jsx("p",{className:"text-sm text-gray-600 whitespace-pre-line",children:t.replace(/\\/g,`
`)}),e.jsx(_,{href:c,variant:x?"link":n?"secondary":"primary",text:u,disabled:x,onClick:()=>!x&&h?.(a)}),n&&e.jsx("span",{className:"absolute top-1 lg:top-4 right-1 lg:right-4 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-success/30 text-success",children:"âœ… Completed"}),d&&e.jsx("span",{className:"absolute  top-1 lg:top-4 right-1 lg:right-4 inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium bg-warning/30 text-warning",children:"â³ In Progress"})]})}function k(...a){return a.filter(Boolean).join(" ")}const O={left:"justify-start",center:"justify-center",right:"justify-end"};function ce({tabs:a=[],defaultTabId:s,onChange:t,align:n="left"}){const d=s?Math.max(0,a.findIndex(i=>i.id===s)):0,[x,u]=r.useState(Math.min(Math.max(d,0),Math.max(0,a.length-1))),c=a[x]||a[0];function h(i){i<0||i>=a.length||(u(i),t?.(a[i].id))}return e.jsxs("div",{children:[e.jsx("div",{className:"border-b border-gray-200",children:e.jsx("nav",{"aria-label":"Tabs",className:k("-mb-px flex space-x-2",O[n]||O.left),children:a.map((i,l)=>e.jsx("button",{onClick:()=>h(l),"aria-current":l===x?"page":void 0,className:k(l===x?"border-secondary text-secondary":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700","group inline-flex items-center border-b-2 px-1 py-4 text-sm font-medium bg-transparent"),type:"button",children:e.jsx("span",{className:"truncate",children:i.label})},i.id))})}),e.jsx("div",{className:"mt-4",children:c?c.content:e.jsx("div",{})})]})}function oe({title:a,subtitle:s,icon:t,info1:n,info2:d,onClick:x,className:u="border-gray-200 bg-white"}){return e.jsxs("div",{role:x?"button":void 0,onClick:x,className:`flex items-center justify-between gap-4 rounded-lg border p-3 hover:shadow-sm ${u}`,children:[t&&e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-lg bg-green-50",children:t})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("p",{className:"font-bold",children:a})}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsx("small",{className:"font-bold",children:s})})]}),e.jsxs("div",{className:"ml-4 flex-shrink-0 text-right",children:[n?e.jsx("div",{children:e.jsx("small",{children:n})}):null,d?e.jsx("div",{children:e.jsx("small",{children:d})}):null]})]})}function Ee({progress:a=[],alerts:s=[]}){return e.jsx(ce,{align:"right",tabs:[{id:"progress",label:e.jsx(C,{icon:e.jsx(ee,{}),size:"md",color:"transparent",className:"text-info","aria-label":"progress",children:"Progress"}),content:e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:a.map(t=>e.jsx(oe,{...t},t.title))})},{id:"alerts",label:e.jsx(C,{icon:e.jsx(J,{}),size:"md",color:"transparent",className:"text-warning","aria-label":"alerts",children:"Alerts"}),content:e.jsx("div",{className:"grid grid-cols-2 gap-4",children:s.map(t=>e.jsx(ie,{title:t.title,variant:t.variant,actionText:t.actionText,children:t.children},t.id))})}]})}function de({value:a,transportModeId:s,livingLabId:t,onChange:n,onCancel:d}){const[x,u]=r.useState(!1),[c,h]=r.useState(a?.status??v.NOT_AVAILABLE),[i,l]=r.useState(a?.id),g={[v.NOT_AVAILABLE]:{color:"light",shortLabel:"Not Available"},[v.IN_SERVICE]:{color:"info",shortLabel:"In Service"},[v.NEW]:{color:"success",shortLabel:"New"},[v.OPTIMIZATION_SCHEDULED]:{color:"warning",shortLabel:"To optimize"}},b=m=>{h(m)},p=()=>{if(!i){const m=Math.floor(Math.random()*1e6);l(m)}i&&c&&(n?.({id:i,status:c,transport_mode_id:s,living_lab_id:t}),u(!1))},o=()=>{h(a?.status??v.NOT_AVAILABLE),d?.(),u(!1)};return x?e.jsxs("form",{onSubmit:p,className:"flex flex-col items-start space-x-3 gap-2 w-40",children:[e.jsx(L,{className:"w-36",children:e.jsx(z,{name:"status",value:c,onChange:m=>b(m.target.value),children:Object.values(v).map(m=>e.jsx("option",{value:m,children:m},m))})}),e.jsxs("div",{className:"flex flex-row justify-end items-end w-full space-x-2",children:[e.jsx("button",{type:"submit","aria-label":"Save",onClick:p,className:"inline-flex items-center",children:e.jsx(R,{className:"h-5 w-5 text-success"})}),e.jsx("button",{type:"button","aria-label":"Cancel",onClick:o,className:"inline-flex items-center",children:e.jsx(K,{className:"h-5 w-5 text-dark"})})]})]}):e.jsxs("div",{className:"flex justify-end items-end gap-1 w-40",children:[e.jsx(C,{size:"sm",color:g[c]?.color,className:"","aria-label":`${c} status in living lab`,children:g[c]?.shortLabel}),e.jsx("button",{type:"button","aria-label":"Edit",onClick:()=>u(!0),className:"inline-flex items-center",children:e.jsx(F,{className:"h-5 w-5 text-[--color-primary]"})})]})}function S({kpiId:a,initial:s,livingLabId:t,transportModeId:n,kpiMetric:d,defaultDate:x,onChange:u}){const c=f=>s?.value!==void 0&&s?.value!==null?Math.round(Number(s.value)*100)/100:void 0,[h,i]=r.useState(!1),[l,g]=r.useState(c(s?.value)),[b,p]=r.useState(T(s?.date??x));r.useEffect(()=>{g(c(s?.value)),p(T(s?.date??x))},[s,x]);const o=f=>{f?.preventDefault();let j=s?.id;j||(j=Date.now()),u?.({id:j,value:Number(l),date:b,transport_mode_id:n}),i(!1)},m=()=>{g(c(s?.value)),s?.date?p(s?.date):p(""),i(!1)},y=f=>f&&d&&d===W.PERCENTAGE?`${Math.round(f*100)}%`:f;return h?e.jsxs("form",{onSubmit:o,className:"flex flex-col items-start space-x-3 gap-2 w-34",children:[e.jsxs(L,{className:"w-32",children:[e.jsx(E,{children:"Value"}),e.jsx(M,{type:"number",name:"value",value:l,onChange:f=>g(Number(f.target.value)),className:"mt-0 m-O"})]}),e.jsxs(L,{className:"w-32",children:[e.jsx(E,{children:"Date"}),e.jsx(M,{type:"date",name:"date",value:b,onChange:f=>p(f.target.value)})]}),e.jsxs("div",{className:"flex flex-row justify-end items-end w-full space-x-2",children:[e.jsx("button",{type:"submit","aria-label":"Save",onClick:o,className:"inline-flex items-center",children:e.jsx(R,{className:"h-5 w-5 text-success"})}),e.jsx("button",{type:"button","aria-label":"Cancel",onClick:m,className:"inline-flex items-center",children:e.jsx(K,{className:"h-5 w-5 text-dark"})})]})]}):e.jsxs("div",{className:"flex items-start gap-1  w-34",children:[e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("p",{children:y(l)??"-"}),l&&b&&e.jsx("span",{className:"text-[12px]",children:b})]}),e.jsx("button",{type:"button","aria-label":"Edit",onClick:()=>i(!0),className:"inline-flex items-center",children:e.jsx(F,{className:"h-5 w-5 text-[--color-primary]"})})]})}function H({onChangeBeforeDate:a,onChangeAfterDate:s}){const t=new Date().toISOString().slice(0,10),[n,d]=r.useState(t),[x,u]=r.useState(t),c=i=>{const l=i.target.value;d(l),a(l)},h=i=>{const l=i.target.value;u(l),s(l)};return e.jsxs("div",{className:"mb-4 flex flex-col lg:flex-row items-center gap-8",children:[e.jsxs(L,{children:[e.jsx(E,{children:"Collection date BEFORE Implementation"}),e.jsx("small",{children:"This date will be set by default for all new KPIs."}),e.jsx(M,{type:"date",name:"data-collection-date",value:n,onChange:c,className:"mt-0 m-O"})]}),e.jsxs(L,{children:[e.jsx(E,{children:"Collection date AFTER Implementation"}),e.jsx("small",{children:"This date will be set by default for all new KPIs."}),e.jsx(M,{type:"date",name:"data-collection-date",value:x,onChange:h,className:"mt-0 m-O"})]})]})}function xe({livingLabId:a,measure:s,initialChecked:t=!1,disabled:n=!0,onToggle:d,className:x=""}){const[u,c]=r.useState(t);function h(l){const g=!u;c(g),d&&d(s,g)}const i=u?"bg-success":"bg-light";return e.jsxs("div",{className:`relative flex flex-col items-center space-x-2 rounded-lg border border-gray-300 px-2 py-2 shadow-xs focus-within:outline-2 focus-within:outline-offset-2 focus-within:outline-indigo-600 hover:border-gray-400 ${i} ${x}`,"aria-label":s.name,onClick:h,children:[e.jsx("div",{className:"shrink-0",children:s.image_url?e.jsx("img",{alt:s.name,src:Z(s.image_url),className:"h-10 w-10"}):null}),e.jsxs("div",{className:"min-w-0 flex-1 gap-y-1 text-center",children:[e.jsx("span",{"aria-hidden":"true",className:"absolute inset-0"}),e.jsx("span",{className:"font-semibold text-sm",children:s.name}),e.jsx("br",{}),s.description?e.jsx("small",{className:"mt-0 leading-0",children:s.description}):null]}),e.jsx("div",{className:"absolute top-1 right-1",children:e.jsx("input",{type:"checkbox",checked:u,onChange:l=>{l.stopPropagation();const g=l.target.checked;c(g),d&&d(s,g)},disabled:n,"aria-label":`select-${s.id}`})})]})}function me({type:a="PUBLIC_TRANSPORT",size:s="sm"}){const t={[I.NSM]:{color:"success",shortLabel:"NSM",description:"New Mobility Service"},[I.PUBLIC_TRANSPORT]:{color:"primary-light",shortLabel:"PT",description:"Public Transport"},[I.PRIVATE]:{color:"warning",shortLabel:"Private",description:"Private Transport (eg. car, bike)"}};return e.jsx(C,{size:s,color:t[a].color,className:"","aria-label":`${a} KPI badge`,tooltip:t[a].description,children:t[a].shortLabel})}function Se({modes:a=[],kpis:s=[],livingLabId:t,livingLabTransportModes:n=[],kpiResults:d=[]}){const x=new Date().toISOString().slice(0,10),[u,c]=r.useState(x),[h,i]=r.useState(x),[l,g]=r.useState(new Map(n.map(o=>[o.transport_mode_id,o]))),[b,p]=r.useState(new Map(d.map(o=>[`${o.id}_${o.result_before?.transport_mode_id}`,o])));return e.jsxs("div",{className:"bg-white shadow rounded-md",children:[e.jsx(H,{onChangeBeforeDate:c,onChangeAfterDate:i}),e.jsx("div",{className:"p-4 overflow-x-auto",children:e.jsxs(P,{dense:!0,striped:!0,className:"[--gutter:--spacing(6)] sm:[--gutter:--spacing(8)]",children:[e.jsx(V,{children:e.jsxs(A,{children:[e.jsx(w,{className:"whitespace-normal break-words",children:"Name"}),e.jsx(w,{className:"whitespace-normal break-words",children:"Status"}),s.map(o=>e.jsx(w,{className:"font-extrabold whitespace-normal break-words text-primary",children:o.name},o.id))]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100",children:a.map(o=>e.jsxs(A,{children:[e.jsxs(N,{className:"max-w-52 flex flex-col break-words",children:[e.jsx(me,{type:o.type}),e.jsx("label",{className:"whitespace-normal break-words",children:o.name}),o.description&&e.jsx("small",{className:"italic w-48 whitespace-normal break-words",children:o.description})]}),e.jsx(N,{children:e.jsx(de,{value:l.get(o.id),transportModeId:o.id,livingLabId:t,onChange:m=>{g(y=>{const f=new Map(y),j=y.get(o.id);return f.set(o.id,{...j,...m}),f})}})}),l.get(o.id)?.status&&s.map(m=>e.jsxs(N,{className:"",children:[b.get(`${m.id}_${o.id}`)?.result_before&&e.jsx("small",{children:"Value before"}),"metric is"," ",b.get(`${m.id}_${o.id}`)?.result_before?.metric,e.jsx(S,{livingLabId:t,kpiId:m.id,kpiMetric:m.metric,initial:b.get(`${m.id}_${o.id}`)?.result_before,transportModeId:o.id,defaultDate:u,onChange:y=>{p(f=>{const j=new Map(f),B=f.get(`${m.id}_${o.id}`);return j.set(`${m.id}_${o.id}`,{...B,result_before:{...B?.result_before,...y}}),j})}}),b.get(`${m.id}_${o.id}`)?.result_before&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{}),e.jsx("small",{children:"Value after"}),e.jsx(S,{transportModeId:o.id,livingLabId:t,kpiMetric:m.metric,kpiId:m.id,initial:b.get(`${m.id}_${o.id}`)?.result_after,defaultDate:h})]})]},m.id))]},o.id))})]})})]})}function ue({type:a="GLOBAL",size:s="sm"}){return e.jsx(C,{size:s,color:a==="GLOBAL"?"primary-light":"secondary",className:"","aria-label":`${a} KPI badge`,children:a})}function _e({kpis:a=[],livingLabId:s,kpiResults:t=[]}){if(!a||a.length===0)return e.jsx("div",{children:"No KPIs available."});const n=new Map(t.map(i=>[i.id,i])),d=new Date().toISOString().slice(0,10),[x,u]=r.useState(d),[c,h]=r.useState(d);return e.jsxs("div",{className:"flex flex-col gap-8",children:[e.jsx(H,{onChangeBeforeDate:u,onChangeAfterDate:h}),e.jsxs(P,{dense:!0,striped:!0,className:"[--gutter:--spacing(6)] sm:[--gutter:--spacing(8)]",children:[e.jsx(V,{children:e.jsxs(A,{children:[e.jsx(w,{children:"KPI Number"}),e.jsx(w,{children:"Name"}),e.jsx(w,{children:"Value Before"}),e.jsx(w,{children:"Value After"})]})}),e.jsx(U,{children:a.map((i,l)=>e.jsxs(A,{children:[e.jsxs(N,{className:"flex flex-col w-22",children:[i.kpi_number,e.jsx(ue,{type:i.type})]}),e.jsx(N,{className:"max-w-48 whitespace-pre-line break-words",children:i.name}),e.jsx(N,{className:"",children:e.jsx(S,{livingLabId:s,kpiId:i.id,initial:n.get(i.id)?.result_before,defaultDate:x})}),e.jsx(N,{className:"w-34",children:e.jsx(S,{livingLabId:s,kpiId:i.id,initial:n.get(i.id)?.result_after,defaultDate:c})})]},i.kpi_number??l))})]})]})}function Re({labs:a}){const[s,t]=r.useState(null),[n,d]=r.useState([50,10]),[x,u]=r.useState(4),c=n?`${n[0]},${n[1]}`:"no-center";r.useEffect(()=>{s&&s.coordinates?.lat&&s.coordinates?.lng&&(d([s.coordinates.lat,s.coordinates.lng]),u(6))},[s]);const h=l=>{switch(l){case"complete":return"bg-success";case"incomplete":return"bg-danger";case"in-progress":return"bg-warning"}},i=a.map(l=>({id:l.id,name:l.name,coordinates:l.coordinates,radius:l.radius*1e3,meta:{lab:l}}));return e.jsx("section",{className:"py-12 px-4 sm:px-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-dark mb-2",children:"Living Labs Across Europe"}),e.jsx("p",{className:"text-dark text-lg",children:"Explore where shared mobility innovation is happening with the SUM project. Click on a city or map marker to view details."})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 h-[600px] rounded shadow overflow-hidden",children:[e.jsx(q,{markers:i,center:n,zoom:x,className:"h-full w-full z-0",onMarkerClick:l=>{if(l.meta&&l.meta.lab)t(l.meta.lab);else{const g=a.find(b=>b.id===l.id);g&&t(g)}}},c),s&&e.jsxs("div",{className:" lg:mr-80 bg-white rounded-lg p-3 shadow border border-primary sticky bottom-0 left-0 z-50",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h4",{className:"font-bold text-primary",children:[s.name," â€“ Living Lab Overview"]}),e.jsx("button",{onClick:()=>t(null),className:"text-sm text-danger hover:underline",children:"Close"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-1 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-dark font-semibold",children:"Total Measures"}),e.jsx("div",{className:"text-gray-700",children:s.totalMeasures})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-dark font-semibold",children:"Transport Modes"}),e.jsx("div",{className:"text-gray-700",children:s.transportModes})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-dark font-semibold",children:"KPIs (Before)"}),e.jsx("div",{className:"text-gray-700",children:s.kpisBefore})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-dark font-semibold",children:"KPIs (After)"}),e.jsx("div",{className:"text-gray-700",children:s.kpisAfter})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-dark font-semibold",children:"Sustainable Modal Split"}),e.jsxs("div",{className:"text-success font-medium",children:[s.sustainablePercentage*100,"%"]})]})]}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-1 justify-center",children:e.jsxs(_,{variant:"primary",href:Z(`/lab-dashboard/${s.id}`),children:["ðŸ” Explore ",s.name," Living Lab"]})})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-4",children:a.map(l=>e.jsxs("div",{onClick:()=>t(l),className:`cursor-pointer p-4 rounded shadow bg-white hover:bg-primary-light transition border-l-4 ${h(l.status)}`,children:[e.jsx("h5",{className:"font-semibold text-primary",children:l.name}),e.jsxs("p",{children:[l.totalMeasures," Measures ",e.jsx("br",{}),l.transportModes," Modes"]})]},l.id))})]})]})})}function Be({livingLabId:a,measures:s=[],title:t="Measures",className:n=""}){return e.jsx("div",{className:`flex flex-col gap-4 items-start my-4 mx-auto ${n}`,children:e.jsxs("div",{className:"flex-1 grid grid-cols-1 gap-4",children:[e.jsx("h4",{className:"text-center",children:t}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-2 mx-1 lg:mx-4 gap-4",children:s.map(d=>e.jsx(xe,{livingLabId:a,measure:d,disabled:!0},d.name))})]})})}export{Ae as CTACard,Ee as LabDashboardTabs,_e as LivingLabKPIs,Be as LivingLabMeasures,Re as LivingLabsMapSection,Se as TransportModesList};
